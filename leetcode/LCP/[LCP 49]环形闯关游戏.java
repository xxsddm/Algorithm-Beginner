//ã€ŒåŠ›æ‰£æŒ‘æˆ˜èµ›ã€ä¸­æœ‰ä¸€ä¸ªç”± `N` ä¸ªå…³å¡ç»„æˆçš„**ç¯å½¢**é—¯å…³æ¸¸æˆï¼Œå…³å¡ç¼–å·ä¸º `0`~`N-1`ï¼Œç¼–å· `0` çš„å…³å¡å’Œç¼–å· `N-1` çš„å…³å¡ç›¸é‚»ã€‚æ¯ä¸ª
//å…³å¡å‡æœ‰ç§¯åˆ†è¦æ±‚ï¼Œ`challenge[i]` è¡¨ç¤ºæŒ‘æˆ˜ç¼–å· `i` çš„å…³å¡æœ€å°‘éœ€è¦æ‹¥æœ‰çš„ç§¯åˆ†ã€‚
//![å›¾ç‰‡.png](https://pic.leetcode-cn.com/1630392170-ucncVS-%E5%9B%BE%E7%89%87.
//png){:width="240px"}
//
//
//å°æ‰£æƒ³è¦æŒ‘æˆ˜å…³å¡ï¼Œé—¯å…³çš„å…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š
//
//- åˆå§‹å°æ‰£å¯ä»¥æŒ‡å®šå…¶ä¸­ä¸€ä¸ªå…³å¡ä¸ºã€Œå¼€å¯ã€çŠ¶æ€ï¼Œå…¶ä½™å…³å¡å°†å¤„äºã€Œæœªå¼€å¯ã€çŠ¶æ€ã€‚
//- å°æ‰£å¯ä»¥æŒ‘æˆ˜å¤„äºã€Œå¼€å¯ã€çŠ¶æ€ä¸”**æ»¡è¶³æœ€å°‘ç§¯åˆ†è¦æ±‚**çš„å…³å¡ï¼Œè‹¥å°æ‰£æŒ‘æˆ˜è¯¥å…³å¡å‰ç§¯åˆ†ä¸º `score`ï¼ŒæŒ‘æˆ˜ç»“æŸåï¼Œç§¯åˆ†å°†å¢é•¿ä¸º `score|
//challenge[i]`ï¼ˆå³ä½è¿ç®—ä¸­çš„ `"OR"` è¿ç®—ï¼‰
//- åœ¨æŒ‘æˆ˜æŸä¸ªå…³å¡åï¼Œè¯¥å…³å¡ä¸¤ä¾§ç›¸é‚»çš„å…³å¡å°†ä¼šå¼€å¯ï¼ˆè‹¥ä¹‹å‰æœªå¼€å¯ï¼‰
//
//è¯·å¸®åŠ©å°æ‰£è¿›è¡Œè®¡ç®—ï¼Œåˆå§‹æœ€å°‘éœ€è¦å¤šå°‘ç§¯åˆ†ï¼Œå¯ä»¥æŒ‘æˆ˜ **ç¯å½¢é—¯å…³æ¸¸æˆ** çš„æ‰€æœ‰å…³å¡ã€‚
//
//**ç¤ºä¾‹1ï¼š**
//
//> è¾“å…¥ï¼š`challenge = [5,4,6,2,7]`
//>
//> è¾“å‡ºï¼š`4`
//> 
//> è§£é‡Šï¼š åˆå§‹é€‰æ‹©ç¼–å· 3 çš„å…³å¡å¼€å¯ï¼Œç§¯åˆ†ä¸º 4
//>æŒ‘æˆ˜ç¼–å· 3 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $4 | 2 = 6$ï¼Œå¼€å¯ 2ã€4 å¤„çš„å…³å¡
//>æŒ‘æˆ˜ç¼–å· 2 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $6 | 6 = 6$ï¼Œå¼€å¯ 1 å¤„çš„å…³å¡
//>æŒ‘æˆ˜ç¼–å· 1 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $6 | 4 = 6$ï¼Œå¼€å¯ 0 å¤„çš„å…³å¡
//>æŒ‘æˆ˜ç¼–å· 0 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $6 | 5 = 7$
//>æŒ‘æˆ˜ç¼–å· 4 çš„å…³å¡ï¼Œé¡ºåˆ©å®Œæˆå…¨éƒ¨çš„å…³å¡
//
//
//**ç¤ºä¾‹2ï¼š**
//
//> è¾“å…¥ï¼š`challenge = [12,7,11,3,9]`
//>
//> è¾“å‡ºï¼š`8`
//>
//> è§£é‡Šï¼š åˆå§‹é€‰æ‹©ç¼–å· 3 çš„å…³å¡å¼€å¯ï¼Œç§¯åˆ†ä¸º 8
//>æŒ‘æˆ˜ç¼–å· 3 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $8 | 3 = 11$ï¼Œå¼€å¯ 2ã€4 å¤„çš„å…³å¡
//>æŒ‘æˆ˜ç¼–å· 2 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $11 | 11 = 11$ï¼Œå¼€å¯ 1 å¤„çš„å…³å¡
//>æŒ‘æˆ˜ç¼–å· 4 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $11 | 9 = 11$ï¼Œå¼€å¯ 0 å¤„çš„å…³å¡
//>æŒ‘æˆ˜ç¼–å· 1 çš„å…³å¡ï¼Œç§¯åˆ†å˜ä¸º $11 | 7 = 15$
//>æŒ‘æˆ˜ç¼–å· 0 çš„å…³å¡ï¼Œé¡ºåˆ©å®Œæˆå…¨éƒ¨çš„å…³å¡
//
//**ç¤ºä¾‹3ï¼š**
//
//> è¾“å…¥ï¼š`challenge = [1,1,1]`
//>
//> è¾“å‡ºï¼š`1`
//
//**æç¤ºï¼š** 
//- `1 <= challenge.length <= 5*10^4`
//- `1 <= challenge[i] <= 10^18` ğŸ‘ 1 ğŸ‘ 0


//leetcode submit region begin(Prohibit modification and deletion)
class Solution {
    int length;
    long[] nums;

    public long ringGame(long[] challenge) {    // ä»æ•°ç»„æœ€å¤§æ•°çš„æœ€é«˜äºŒè¿›åˆ¶ä½æ¬¡å¼€å§‹æšä¸¾æ¯ä¸€ä½æ˜¯å¦å¿…é¡»ä¸º1
        length = challenge.length;
        if (length == 1) {
            return challenge[0];
        }
        nums = challenge;
        // challengeä¸­æœ€å¤§æ•°å­—çš„äºŒè¿›åˆ¶æœ€é«˜ä½å¿…ç„¶å–1æ‰æœ‰æœºä¼šå®Œæ•´éå†
        int maxIdx = 62;    // äºŒè¿›åˆ¶æœ€é«˜ä½æ¬¡(ä»å³å¾€å·¦ç¬¬maxIdx+1ä½æ•°å­—ä¸º1(1<<maxIdx))
        long maxnum = 0, ans = (long) 1 << maxIdx;
        for (long num: nums) {
            maxnum = Math.max(maxnum, num);
        }
        while (ans > maxnum) {
            ans >>= 1;
            maxIdx--;
        }
//        if (maxIdx == 0) {
//            return 1;
//        }

        // ä¾æ¬¡æšä¸¾æœ€é«˜ä½ä¹‹åçš„å„ä¸ªä½æ¬¡æ˜¯å¦ä¸º1(äºŒè¿›åˆ¶)
        for (int i = maxIdx - 1; i >= 0; i--) {
            // æ£€æŸ¥è¯¥ä½æ¬¡,åˆ™æ›´å°çš„ä½æ¬¡å…¨éƒ¨å–1(å³è¾ƒå°ä½æ¬¡å–æœ€å¤§å€¼)
            long temp = ans ^ ((1L << i) - 1);
            // è¯¥ä½æ¬¡å–0æ—¶è‹¥ä¸å­˜åœ¨å¯ä»¥å®Œæ•´éå†çš„æƒ…å†µ,åˆ™è¯¥ä½æ¬¡å¿…é¡»ä¸º1
            if (!check(temp)) {
                ans ^= 1L << i;
            }
        }

        return ans;
    }

    // è€ƒè™‘è¿‡ä½¿ç”¨å¹¶æŸ¥é›†,ä½†æ•ˆæœå¾ˆå·®
    // è¿™é‡ŒåŒæ—¶å¤„ç†nextå’Œprevå¯¹startå‰©ä½™å¯èƒ½å–å€¼èŒƒå›´çš„ç¼©å‡
    private boolean check(long num) {   // è¾“å…¥çš„numæ˜¯å¦å¯ä»¥ä½œä¸ºåˆå§‹å€¼éå†challenge
        int start = 0, limit = length;
        while (start < limit){
            long curr = num;
            if (curr < nums[start]) {
                start++;
                continue;
            }
            curr |= nums[start];
            // prev:å¾…è€ƒè™‘çš„å‰èŠ‚ç‚¹; next:å¾…è€ƒè™‘çš„åèŠ‚ç‚¹
            int prev = getIdx(start - 1), next = getIdx(start + 1);
            while (prev != next) {
                if (curr >= nums[prev]) {
                    curr |= nums[prev];
                    prev = getIdx(prev - 1);
                }
                else if (curr >= nums[next]) {
                    curr |= nums[next];
                    next = getIdx(next + 1);
                }
                else  {
                    break;
                }
            }
            if (prev != next) {
                // è¢«prev~nextè¦†ç›–çš„åŒºåŸŸä¸å¿…ä½œä¸ºstartç‚¹(è‹¥next<prev)
                if (prev > start) {
                    // è‹¥prevç©¿è¿‡é¦–ç«¯ä»æœ«ç«¯å¼€å§‹,åˆ™prevç©¿è¿‡éƒ¨åˆ†ä½œä¸ºstartä¹Ÿæ— æ³•éå†æ•°ç»„
                    limit = Math.min(limit, prev);
                }
                if (next <= start) {
                    // nextå¯èƒ½ç©¿è¿‡æœ«ç«¯ä»é¦–ç«¯å¼€å§‹,è€Œnextåˆ™å·²ç”±ä¹‹å‰è¾ƒå°startä½œä¸ºèµ·ç‚¹å°è¯•è¿‡
                    // start~nums.length-1è¢«åŒ…å«åœ¨æœ¬æ¬¡éå†å¯è¾¾èŒƒå›´,ä¹Ÿä¸éœ€è¦ä½œä¸ºstart
                    return false;
                }
                start = next + 1;
                continue;
            }
            return curr >= nums[next];
        }
        return false;
    }

    private int getIdx(int idx) {   // è¿”å›æ ¹æ®challengeé•¿åº¦ä¿®æ­£çš„ç¯å½¢ç´¢å¼•
        if (idx == -1) {
            return length - 1;
        }
        if (idx == length) {
            return 0;
        }
        return idx;
    }
}

//leetcode submit region end(Prohibit modification and deletion)
